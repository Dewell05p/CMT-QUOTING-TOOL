name: Fetch Google Sheet Data

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

# THIS IS THE NEW PART THAT FIXES THE ERROR
permissions:
  contents: write

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest
    steps:
      # 1. Checks out your repository code
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. Runs the command to fetch data and save it as data.json
      - name: Fetch data from Google Apps Script
        run: |
          curl -L "${{ secrets.APPS_SCRIPT_URL }}" -o data.json

      # 3. This magical action checks if data.json changed.
      #    It will now have permission to commit.
      - name: Commit new data
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Update: Fetched new data from Google Sheet"
          file_pattern: data.json
