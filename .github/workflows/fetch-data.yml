name: Fetch Google Sheet Data

on:
  schedule:
    # This runs the "robot" every 30 minutes
    - cron: '*/30 * * * *'
  # This adds a button on the "Actions" tab to run it manually
  workflow_dispatch:

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest
    steps:
      # 1. Checks out your repository code
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. Fetches data using your secret URL and saves it as data.json
      - name: Fetch data from Google Apps Script
        run: |
          curl -L "${{ secrets.APPS_SCRIPT_URL }}" -o data.json

      # 3. Automatically saves the new data.json file back to your repository
      - name: Commit new data
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Update: Fetched new data from Google Sheet"
          file_pattern: data.json
